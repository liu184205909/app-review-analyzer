# ğŸ”§ ä¿®å¤æ•°æ®åº“è¿ç§»é—®é¢˜

## é—®é¢˜æè¿°

```
Invalid `prisma.analysisTask.findFirst()` invocation:
The column `AnalysisTask.reviewCount` does not exist in the current database.
```

**åŸå› **ï¼šä»£ç ä¸­ä½¿ç”¨äº† `reviewCount` å­—æ®µï¼Œä½†æ•°æ®åº“ä¸­æ²¡æœ‰è¿™ä¸ªåˆ—ã€‚

---

## âœ… è§£å†³æ–¹æ¡ˆï¼ˆæŒ‰é¡ºåºå°è¯•ï¼‰

### æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ Vercel CLI è¿è¡Œè¿ç§»ï¼ˆæ¨èï¼‰

```bash
# 1. ç¡®ä¿å·²å®‰è£… Vercel CLI
npm install -g vercel

# 2. ç™»å½• Vercel
vercel login

# 3. é“¾æ¥åˆ°é¡¹ç›®
vercel link

# 4. æ‹‰å–ç”Ÿäº§ç¯å¢ƒå˜é‡
vercel env pull .env.production

# 5. ä½¿ç”¨ç”Ÿäº§æ•°æ®åº“è¿è¡Œè¿ç§»
DATABASE_URL=$(grep DATABASE_URL .env.production | cut -d '=' -f2-) npx prisma db push

# æˆ–è€…ä½¿ç”¨ migrate deployï¼ˆæ›´å®‰å…¨ï¼‰
DATABASE_URL=$(grep DATABASE_URL .env.production | cut -d '=' -f2-) npx prisma migrate deploy
```

### æ–¹æ¡ˆ 2ï¼šé€šè¿‡ Vercel é‡æ–°éƒ¨ç½²

1. **åˆ›å»º Prisma è¿ç§»æ–‡ä»¶**ï¼ˆæœ¬åœ°ï¼‰

```bash
# åˆ›å»ºè¿ç§»
npx prisma migrate dev --name add_review_count_to_analysis_task

# è¿™ä¼šåˆ›å»ºä¸€ä¸ªè¿ç§»æ–‡ä»¶åœ¨ prisma/migrations/ ç›®å½•
```

2. **æäº¤å¹¶æ¨é€åˆ° Git**

```bash
git add prisma/migrations
git commit -m "Add database migration for reviewCount field"
git push
```

3. **Vercel ä¼šè‡ªåŠ¨éƒ¨ç½²å¹¶è¿è¡Œè¿ç§»**

### æ–¹æ¡ˆ 3ï¼šæ‰‹åŠ¨ SQLï¼ˆæœ€å¿«ä½†éœ€è°¨æ…ï¼‰

å¦‚æœä½ æœ‰æ•°æ®åº“çš„ç›´æ¥è®¿é—®æƒé™ï¼ˆSupabase/Neon Dashboardï¼‰ï¼š

```sql
-- æ·»åŠ ç¼ºå¤±çš„åˆ—
ALTER TABLE "AnalysisTask" 
ADD COLUMN IF NOT EXISTS "reviewCount" INTEGER;

ALTER TABLE "AnalysisTask" 
ADD COLUMN IF NOT EXISTS "tokensUsed" INTEGER;

ALTER TABLE "AnalysisTask" 
ADD COLUMN IF NOT EXISTS "cost" DOUBLE PRECISION;
```

---

## ğŸ¯ æ¨èæ­¥éª¤ï¼ˆè¯¦ç»†ï¼‰

### Step 1: æœ¬åœ°åˆ›å»ºè¿ç§»

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd "D:\Project code\app-review-analyzer"

# ç¡®ä¿æœ¬åœ° schema æ˜¯æœ€æ–°çš„
git pull

# åˆ›å»ºè¿ç§»
npx prisma migrate dev --name add_analysis_tracking_fields
```

### Step 2: æŸ¥çœ‹ç”Ÿæˆçš„è¿ç§»æ–‡ä»¶

æ£€æŸ¥ `prisma/migrations/[timestamp]_add_analysis_tracking_fields/migration.sql`ï¼š

```sql
-- AlterTable
ALTER TABLE "AnalysisTask" ADD COLUMN "cost" DOUBLE PRECISION,
ADD COLUMN "reviewCount" INTEGER,
ADD COLUMN "tokensUsed" INTEGER;
```

### Step 3: æäº¤å¹¶æ¨é€

```bash
git add prisma/migrations
git add prisma/schema.prisma
git commit -m "Add reviewCount, tokensUsed, and cost fields to AnalysisTask"
git push
```

### Step 4: åœ¨ Vercel è¿è¡Œè¿ç§»

**é€‰é¡¹ Aï¼šè‡ªåŠ¨è¿è¡Œï¼ˆåœ¨ vercel.json ä¸­é…ç½®ï¼‰**

åˆ›å»ºæˆ–æ›´æ–° `vercel.json`ï¼š

```json
{
  "buildCommand": "prisma generate && prisma migrate deploy && next build"
}
```

ç„¶åé‡æ–°éƒ¨ç½²ã€‚

**é€‰é¡¹ Bï¼šæ‰‹åŠ¨è¿è¡Œï¼ˆé€šè¿‡ Vercel CLIï¼‰**

```bash
# è¿æ¥åˆ°ç”Ÿäº§ç¯å¢ƒ
vercel link

# è¿è¡Œè¿ç§»
vercel env pull .env.production
npx prisma migrate deploy --schema=./prisma/schema.prisma
```

---

## ğŸ” éªŒè¯ä¿®å¤

éƒ¨ç½²æˆåŠŸåï¼Œæµ‹è¯•åˆ†æåŠŸèƒ½ï¼š

```bash
# 1. æµ‹è¯• API å¥åº·æ£€æŸ¥
curl https://your-app.vercel.app/api/health

# 2. å°è¯•åˆ›å»ºåˆ†æ
# åœ¨æµè§ˆå™¨ä¸­è®¿é—®ä½ çš„åº”ç”¨å¹¶æµ‹è¯•åˆ†æåŠŸèƒ½
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å¤‡ä»½æ•°æ®åº“**ï¼šåœ¨è¿è¡Œè¿ç§»å‰ï¼Œå»ºè®®å¤‡ä»½ç”Ÿäº§æ•°æ®åº“
2. **æ£€æŸ¥å½±å“**ï¼šè¿™äº›æ˜¯æ–°å¢åˆ—ï¼Œä¸ä¼šå½±å“ç°æœ‰æ•°æ®
3. **æµ‹è¯•ç¯å¢ƒ**ï¼šå»ºè®®å…ˆåœ¨é¢„è§ˆç¯å¢ƒæµ‹è¯•

---

## ğŸ› å¦‚æœè¿ç§»å¤±è´¥

### é”™è¯¯ï¼šè¿æ¥æ•°æ®åº“å¤±è´¥

```bash
# æ£€æŸ¥ DATABASE_URL
echo $DATABASE_URL

# æˆ–åœ¨ Windows PowerShell
$env:DATABASE_URL
```

### é”™è¯¯ï¼šæƒé™ä¸è¶³

ç¡®ä¿æ•°æ®åº“ç”¨æˆ·æœ‰ ALTER TABLE æƒé™ã€‚

### é”™è¯¯ï¼šè¿ç§»å†²çª

```bash
# æŸ¥çœ‹è¿ç§»çŠ¶æ€
npx prisma migrate status

# é‡ç½®è¿ç§»ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
npx prisma migrate reset
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Prisma Migrations](https://www.prisma.io/docs/concepts/components/prisma-migrate)
- [Vercel Environment Variables](https://vercel.com/docs/concepts/projects/environment-variables)
- [éƒ¨ç½²æŒ‡å—](./éƒ¨ç½²æŒ‡å—.md)

---

**å®Œæˆåï¼Œæ•°æ®åº“é”™è¯¯åº”è¯¥å°±è§£å†³äº†ï¼** ğŸ‰

